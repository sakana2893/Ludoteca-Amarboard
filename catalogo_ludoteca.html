<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Catalogo Giochi Ludoteca</title>
    <!-- DataTables CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.8/css/jquery.dataTables.min.css">
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <!-- DataTables JS -->
    <script src="https://cdn.datatables.net/1.13.8/js/jquery.dataTables.min.js"></script>
    <!-- PapaParse per leggere il CSV -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

    <style>
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        h1 {
            text-align: center;
            margin-bottom: 10px;
        }
        .subtitle {
            text-align: center;
            margin-bottom: 20px;
            color: #555;
        }
        #wrapper {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 15px 20px 25px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }
        table.dataTable thead th {
            background-color: #ececec;
        }
        .badge {
            padding: 3px 8px;
            border-radius: 999px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-block;
        }
        .badge-disponibile {
            background-color: #d4edda;
            color: #155724;
        }
        .badge-prestato {
            background-color: #f8d7da;
            color: #721c24;
        }
        .small {
            font-size: 0.75rem;
            color: #777;
        }
    </style>
</head>
<body>
<div id="wrapper">
    <h1>Catalogo Giochi</h1>
    <div class="subtitle">
        Stato aggiornato dal gestionale Excel â€¢ Cerca per titolo, categoria, giocatori...
    </div>

    <table id="tblCatalogo" class="display" style="width:100%">
        <thead>
        <tr>
            <th>Titolo</th>
            <th>Giocatori</th>
            <th>Durata</th>
            <th>Categoria</th>
            <th>Disponibili</th>
            <th>Stato</th>
        </tr>
        </thead>
        <tbody>
        <!-- Riempito via JS -->
        </tbody>
    </table>
</div>

<script>
    // ðŸ‘‰ SOSTITUISCI QUESTA STRINGA CON L'URL CSV DI GOOGLE SHEETS
    const CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRexz50v1WXvZwhMjMiqTt_jAUGXlhJQ63CvtOalhzzsCVf_0a0lwsgzmzKudFcOZU1UppDHRUcpezu/pub?output=csv";

    // Indici delle colonne nel CSV (basati sulla macro CatalogoWeb):
    // 0: IDGioco
    // 1: Barcode
    // 2: Titolo
    // 3: NumeroGiocatori
    // 4: Durata
    // 5: Categoria
    // 6: CopieTotali
    // 7: CopieDisponibili
    // 8: StatoDisponibilita

    function statoBadge(stato) {
        stato = (stato || "").toString().toLowerCase();
        if (stato === "disponibile") {
            return '<span class="badge badge-disponibile">Disponibile</span>';
        } else if (stato === "in prestito") {
            return '<span class="badge badge-prestato">In prestito</span>';
        } else {
            return '<span class="badge">' + (stato || "") + '</span>';
        }
    }

    // Carica CSV e inizializza tabella
    document.addEventListener("DOMContentLoaded", function () {
        Papa.parse(CSV_URL, {
            download: true,
            header: true,
            complete: function (results) {
                const data = results.data || [];
                const rows = [];

                data.forEach(function (row) {
                    if (!row["Titolo"]) return; // salta righe vuote

                    const titolo = row["Titolo"];
                    const giocatori = row["NumeroGiocatori"] || "";
                    const durata = row["Durata"] || "";
                    const categoria = row["Categoria"] || "";
                    const copieDisp = row["CopieDisponibili"] || "";
                    const stato = row["StatoDisponibilita"] || "";

                    rows.push([
                        titolo,
                        giocatori,
                        durata,
                        categoria,
                        copieDisp,
                        statoBadge(stato)
                    ]);
                });

                $('#tblCatalogo').DataTable({
                    data: rows,
                    columns: [
                        { title: "Titolo" },
                        { title: "Giocatori" },
                        { title: "Durata" },
                        { title: "Categoria" },
                        { title: "Disponibili" },
                        { title: "Stato", orderable: false }
                    ],
                    pageLength: 25,
                    order: [[0, "asc"]],
                    language: {
                        url: "https://cdn.datatables.net/plug-ins/1.13.8/i18n/it-IT.json"
                    }
                });
            },
            error: function (err) {
                console.error("Errore nel caricamento del CSV:", err);
                alert("Impossibile caricare il catalogo. Controlla l'URL CSV in alto nel file HTML.");
            }
        });
    });
</script>
</body>
</html>

