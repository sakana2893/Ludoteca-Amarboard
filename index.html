<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Catalogo Giochi â€“ AmarBoard Natale</title>

  <!-- No cache per l'HTML -->
  <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">

  <!-- DataTables CSS -->
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.8/css/jquery.dataTables.min.css">

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

  <!-- DataTables JS -->
  <script src="https://cdn.datatables.net/1.13.8/js/jquery.dataTables.min.js"></script>

  <!-- PapaParse per leggere CSV -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

  <!-- Twemoji per emoji compatibili ovunque -->
  <script src="https://twemoji.maxcdn.com/v/latest/twemoji.min.js" crossorigin="anonymous"></script>

  <style>
    /* === (omesso qui per brevitÃ  di copy, usa lo stile completo che ti avevo giÃ  fornito sopra) === */
    /* Riporta TUTTO lo stile che abbiamo nel precedente HTML, includendo neve, garlanda, layout, loghi, filtri, tabelle, modali, ecc. */
    /* ğŸ‘† Copia esattamente la sezione <style> dal tuo precedente HTML completo che ti ho inviato. */
  </style>
</head>

<body>

<!-- ADMIN BADGE -->
<div id="adminBadge">
  <div class="pill">ğŸ›¡ï¸ ADMIN MODE</div>
  <button id="btnLogoutTop" type="button">Logout</button>
</div>

<!-- PIN MODAL -->
<div id="pinModal" aria-hidden="true">
  <div class="card">
    <h2>Accesso Admin</h2>
    <p>Inserisci il PIN per accedere alla gestione completa.</p>
    <input id="pinInput" type="password" placeholder="PIN">
    <div class="row">
      <button class="cancel" id="btnPinCancel">Annulla</button>
      <button class="ok" id="btnPinOk">Entra</button>
    </div>
    <div class="err" id="pinErr">PIN errato.</div>
  </div>
</div>

<!-- PRENOTA MODAL -->
<div id="prenotaModal" aria-hidden="true">
  <div class="card">
    <h2 id="prenotaTitle">ğŸ“Œ Richiedi prenotazione</h2>
    <input id="reqNome" type="text" placeholder="Nome e cognome *">
    <input id="reqTel" type="text" placeholder="Telefono (opzionale)">
    <textarea id="reqNote" placeholder="Note (opzionale)"></textarea>
    <input id="honeypotWebsite" type="text" placeholder="">

    <div class="row">
      <button class="cancel" id="btnReqCancel">Annulla</button>
      <button class="ok" id="btnReqSend">Invia</button>
    </div>

    <div class="msg-ok" id="reqOkMsg">Richiesta inviata âœ…</div>
  </div>
</div>

<!-- COUNTDOWN BANNER (se presente) -->
<div id="countdownBanner" style="display:none;">
  ğŸ La pagina della nostra Ludoteca si sbloccherÃ  tra <span id="countdownTime">--:--:--</span>
  <small>Fino ad allora, catalogo coperto!</small>
  <div id="countdownActions">
    <button class="btn-mini btn-admin" id="btnOpenPin">ğŸ”‘ Admin</button>
    <button class="btn-mini btn-logout" id="btnLogoutBanner">ğŸšª Logout</button>
  </div>
</div>

<!-- Main UI -->
<div class="garland">
  <span>âœ¨</span><span>ğŸ„</span><span>â­</span><span>ğŸ•¯ï¸</span>
  <span>ğŸ² AmarBoard Romagna ğŸ²</span>
  <span>â­</span><span>ğŸ„</span><span>âœ¨</span>
</div>

<div class="snowflake">â„</div><div class="snowflake">âœ»</div><div class="snowflake">â…</div>
<div class="snowflake">â†</div><div class="snowflake">â„</div><div class="snowflake">âœµ</div><div class="snowflake">â„</div>

<div id="wrapper">
  <!-- header -->
  <div class="header-flex">
    <span class="xmas-icon">ğŸ„</span>
    <img class="logo-amar"
         src="https://raw.githubusercontent.com/sakana2893/Ludoteca-Amarboard/main/logo_amarboard.png"
         alt="AmarBoard Romagna">
    <span class="xmas-icon">ğŸ²</span>
  </div>

  <h1>Catalogo Giochi â€“ AmarBoard</h1>
  <div class="subtitle">
    <span>Speciale Natale:</span> trova il gioco giusto (o fatti suggerire dai nostri Volontari) da intavolare con gli amici sui nostri tavoli.
  </div>

  <!-- Statistiche -->
  <div class="stats-bar">
    <div class="stat-box"><div class="stat-label">Giochi in prestito</div><div class="stat-value" id="cntAttivi">â€“</div></div>
    <div class="stat-box"><div class="stat-label">Prestiti totali</div><div class="stat-value" id="cntTotali">â€“</div></div>
    <div class="stat-box stat-top"><div class="stat-label">Top 3 giochi piÃ¹ prestati</div><ol id="topList"></ol></div>
  </div>

  <!-- Filtri -->
  <div class="filters">
    <div class="filters-left">
      <div class="filter-block">
        <span class="filter-label">Stato</span>
        <select id="filtroStato">
          <option value="">Tutti</option>
          <option value="Disponibile">Disponibile</option>
          <option value="In prestito">In prestito</option>
        </select>
      </div>
      <div class="filter-block">
        <span class="filter-label">Giocatori (contiene)</span>
        <input type="text" id="filtroGiocatori" placeholder="es. 2-4">
      </div>
    </div>
    <button id="btnRefresh">ğŸ”„ Aggiorna dati</button>
  </div>

  <div id="errorBox"></div>

  <table id="tblCatalogo" class="display" style="width:100%">
    <thead>
      <tr>
        <th>Titolo</th><th>Giocatori</th><th>Durata</th><th>EtÃ </th>
        <th>Editore</th><th>Disponibili</th><th>Stato</th><th>BGG</th><th>Richiedi</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div class="footer-note">
    ğŸ… Catalogo generato dalla ludoteca AmarBoard â€“ versione natalizia
  </div>
</div>

<script>
  // === CONFIG ===
  const API_URL = "https://script.google.com/macros/s/AKfycby-o0FWIL1NVCr_bWznqmkA4yCBnIhQzdyQGOaLDbAD-q_MOfBMjhL1knxVoPWbhHSl/exec";
  const CSV_BASE_URL   = "/catalogo_ludoteca.csv";
  const STATS_BASE_URL = "/stats_ludoteca.csv";
  const ADMIN_PIN = "2486";
  const REVEAL_AT = new Date("2026-01-01T09:00:00+01:00").getTime();

  // (poi il resto del JavaScript lo riprendi **esattamente** da quanto giÃ  ti ho inviato: gestione countdown, admin PIN, badge, fetch CSV, parsing, DataTable init, filtri, prenotazione beacon GET, ecc.)

  // Assicurati che nel tuo file ci sia TUTTO lo script completo
  // che abbiamo giÃ  scritto prima, senza modificare i nomi di id/elementi.
</script>

</body>
</html>
