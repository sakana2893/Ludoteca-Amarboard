<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <title>Registrazione – AmarBoard</title>
  <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <style>
    body{font-family:system-ui,-apple-system,"Segoe UI",sans-serif;background:#111;color:#f5f5f5;margin:0}
    .wrap{max-width:520px;margin:24px auto;padding:16px}
    .card{background:#181818;border:1px solid #333;border-radius:14px;padding:14px}
    label{display:block;margin-top:10px;color:#ccc}
    input{width:100%;padding:10px;border-radius:10px;border:1px solid #444;background:#111;color:#fff}
    .btn{margin-top:14px;padding:10px 12px;border-radius:10px;border:1px solid #1f7a3a;background:#102818;color:#a9ffbd;font-weight:800;cursor:pointer}
    .err{margin-top:10px;color:#ffb3b3;font-weight:800}
    a{color:#8bd1ff}
  </style>
</head>
<body>
<div class="wrap">
  <a href="index.html">⬅️ Torna al catalogo</a>
  <div class="card" style="margin-top:12px">
    <h2 style="margin:0 0 6px">Registrati</h2>
    <div style="color:#aaa;font-size:.9rem">Username (3-40) solo lettere/numeri/._-</div>

    <label>Username</label>
    <input id="u" autocomplete="username">

    <label>Nome</label>
    <input id="n" autocomplete="name">

    <label>Telefono</label>
    <input id="t" autocomplete="tel">

    <label>Password</label>
    <input id="p" type="password" autocomplete="new-password">

    <button class="btn" id="go">Crea account</button>
    <div class="err" id="err"></div>

    <div style="margin-top:12px;font-size:.95rem">
      Hai già un account? <a href="index.html">Vai al catalogo e fai login</a>
    </div>
  </div>
</div>

<script>
/* incolla QUI lo stesso code.js con API_URL */
</script>

<script>
E("go").onclick = async ()=>{
  try{
    E("err").textContent="";
    const username = E("u").value.trim().toLowerCase();
    const nome = E("n").value.trim();
    const telefono = E("t").value.trim();
    const pass = E("p").value;
    const passhash = await sha256Hex(pass);

    const r = await api("register", { username, nome, telefono, passhash });
    if(!r.ok) throw new Error(r.error||"Errore registrazione");

    // auto-login
    const prof = await doLogin(username, pass);
    location.href = "index.html";
  }catch(e){
    E("err").textContent = e.message || "Errore";
  }
};
</script>
</body>
</html>
