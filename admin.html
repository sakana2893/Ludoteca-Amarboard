<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Admin Prenotazioni ‚Äì AmarBoard</title>

  <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

  <style>
    :root {
      --rosso-natale: #b02030;
      --verde-natale: #1f7a3a;
      --oro-soft:    #f3d08a;
    }
    *{ box-sizing:border-box; }
    body{
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Color Emoji", "Apple Color Emoji", sans-serif;
      margin:0; padding:0;
      background: radial-gradient(circle at top, #ffe9e9, #fdf5e6 45%, #e4f5ea 100%);
      min-height:100vh;
      overflow-x:hidden;
    }
    .garland {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 60px;
      background: radial-gradient(circle at center, rgba(31,122,58,0.7), rgba(0,0,0,0.3));
      display:flex; align-items:center; justify-content:center;
      gap:10px; color:#ffe;
      font-size: 1.1rem;
      z-index:2;
      box-shadow: 0 2px 8px rgba(0,0,0,0.3);
      padding: 0 10px;
    }
    #wrapper{
      max-width: 1200px;
      margin: 90px auto 40px;
      padding: 24px 26px 30px;
      background: rgba(255,250,243,0.96);
      border-radius: 20px;
      box-shadow: 0 0 0 3px rgba(255,255,255,0.8),
                  0 0 18px rgba(176,32,48,0.4);
      position: relative;
      z-index: 3;
      border: 2px solid rgba(176,32,48,0.35);
    }
    #wrapper::before{
      content:"";
      position:absolute; inset:8px;
      border-radius:16px;
      border:2px dashed rgba(243,208,138,0.7);
      pointer-events:none;
    }

    .topbar{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
      margin-bottom: 10px;
      position:relative;
    }
    h1{
      margin:0;
      color: var(--rosso-natale);
      font-size: 1.55rem;
      text-shadow: 0 1px 0 #fff, 0 0 6px rgba(176,32,48,0.35);
    }
    .btn{
      padding: 8px 12px;
      border-radius: 10px;
      border:1px solid rgba(31,122,58,0.35);
      background:#f7fff7;
      color:#1f7a3a;
      font-weight:900;
      cursor:pointer;
      box-shadow: 0 2px 6px rgba(0,0,0,0.06);
      white-space:nowrap;
    }
    .btn.red{
      border-color: rgba(176,32,48,0.35);
      background:#fff7f7;
      color:#b02030;
    }
    .btn:disabled{ opacity:.6; cursor:not-allowed; }

    .card{
      background: linear-gradient(135deg,#fff,#fffdf7);
      border-radius: 12px;
      padding: 12px 12px;
      border: 1px solid rgba(176,32,48,0.2);
      box-shadow: 0 2px 6px rgba(0,0,0,0.06);
      margin: 12px 0;
    }
    .grid{
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap: 12px;
    }
    .field{
      display:flex;
      flex-direction:column;
      gap:6px;
    }
    label{
      font-weight:900;
      font-size:0.85rem;
      color:#444;
    }
    input, select{
      padding: 8px 10px;
      border-radius: 10px;
      border:1px solid #ccc;
      font-size: 0.95rem;
      background:#fff;
    }
    .note{
      font-size:0.85rem;
      color:#555;
      line-height:1.35;
    }
    #infoBox, #errorBox{
      display:none;
      margin: 10px 0 12px;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(176,32,48,0.35);
      background: rgba(255, 231, 231, 0.85);
      color: #7a0f1a;
      font-size: 0.9rem;
      line-height: 1.35;
      box-shadow: 0 2px 6px rgba(0,0,0,0.06);
    }
    #infoBox{
      border-color: rgba(31,122,58,0.28);
      background: rgba(233, 255, 240, 0.85);
      color:#145c2a;
    }

    table{
      width:100%;
      border-collapse: collapse;
      margin-top: 8px;
      font-size: 0.92rem;
    }
    th, td{
      border-bottom: 1px solid rgba(0,0,0,0.08);
      padding: 10px 8px;
      vertical-align: top;
    }
    th{
      text-align:left;
      background: linear-gradient(180deg,#f7f7f7,#e3e3e3);
      border-bottom: 2px solid var(--rosso-natale);
      position: sticky;
      top: 60px;
      z-index: 1;
    }

    .pill{
      padding: 4px 10px;
      border-radius: 999px;
      font-weight: 900;
      font-size: 0.75rem;
      display:inline-block;
      white-space:nowrap;
      border: 1px solid rgba(0,0,0,0.08);
    }
    .pill.new{ background:#fff3cd; color:#856404; border-color:#ffeeba; }
    .pill.appr{ background:#d1ecf1; color:#0c5460; border-color:#bee5eb; }
    .pill.rej{ background:#f8d7da; color:#721c24; border-color:#f1b0b7; }
    .pill.del{ background:#e2e3e5; color:#383d41; border-color:#d6d8db; }

    .actions{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
    }

    .pager{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      margin-top: 10px;
    }
    .pager .meta{
      font-weight:900;
      color:#444;
      font-size:0.9rem;
    }

    /* MODAL login */
    .modal-backdrop{
      position:fixed; inset:0;
      background: rgba(0,0,0,0.45);
      display:none;
      align-items:center;
      justify-content:center;
      z-index: 10000;
      padding: 14px;
    }
    .modal{
      width: min(520px, 100%);
      background: rgba(255,250,243,0.98);
      border: 2px solid rgba(176,32,48,0.28);
      border-radius: 16px;
      box-shadow: 0 12px 40px rgba(0,0,0,0.25);
      padding: 14px 14px 12px;
      position:relative;
    }
    .modal h2{ margin:6px 0 10px; font-size:1.2rem; color:#7a0f1a; }
    .modal .row{ display:flex; gap:10px; flex-wrap:wrap; }
    .modal .msg{ margin-top:8px; font-size:0.9rem; font-weight:900; color:#7a0f1a; }
    .closeX{
      position:absolute; top:10px; right:10px;
      border:none; background:transparent; cursor:pointer;
      font-size:1.2rem; line-height:1;
    }

    @media(max-width: 900px){
      .grid{ grid-template-columns: 1fr; }
      th{ top: 60px; }
    }
  </style>
</head>
<body>

<div class="garland">
  <span>‚ú®</span><span>üéÑ</span><span>‚≠ê</span><span>üé≤ Admin AmarBoard üé≤</span><span>‚≠ê</span><span>üéÑ</span><span>‚ú®</span>
</div>

<div id="wrapper">
  <div class="topbar">
    <h1>Admin Prenotazioni</h1>
    <div style="display:flex;gap:8px;flex-wrap:wrap;">
      <button class="btn" id="btnBack">‚Üê Torna al catalogo</button>
      <button class="btn" id="btnPreview">Apri catalogo in preview</button>
      <button class="btn red" id="btnLogout" style="display:none;">Esci</button>
      <button class="btn" id="btnLogin">Accedi</button>
    </div>
  </div>

  <div id="infoBox"></div>
  <div id="errorBox"></div>

  <div class="card">
    <div class="grid">
      <div class="field">
        <label>Solo utenti registrati possono richiedere</label>
        <select id="cfgRequireLogin">
          <option value="0">No (chiunque pu√≤ richiedere)</option>
          <option value="1">S√¨ (serve login)</option>
        </select>
        <div class="note">Se attivi questa opzione, su <strong>index</strong> il tasto ‚ÄúRichiedi‚Äù richieder√† login.</div>
      </div>

      <div class="field">
        <label>Countdown (spoiler shield)</label>
        <select id="cfgCountdown">
          <option value="0">Disattivo</option>
          <option value="1">Attivo</option>
        </select>
        <div class="note">Se attivo e <strong>RevealAt</strong> √® nel futuro, il catalogo resta coperto.</div>
      </div>

      <div class="field">
        <label>RevealAt (ISO) ‚Äì esempio</label>
        <input id="cfgRevealAt" placeholder="2025-12-24T09:00:00+01:00">
        <div class="note">Lascia vuoto per ‚Äúsempre visibile‚Äù.</div>
      </div>

      <div class="field">
        <label>Salva configurazione</label>
        <button class="btn" id="btnSaveCfg">Salva</button>
        <div class="note">Dopo il salvataggio, ricarica index (o aspetta l‚Äôauto refresh).</div>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="pager">
      <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center;">
        <button class="btn" id="btnPrev">‚óÄ Prev</button>
        <button class="btn" id="btnNext">Next ‚ñ∂</button>
        <select id="pageSize">
          <option value="10">10</option>
          <option value="25" selected>25</option>
          <option value="50">50</option>
          <option value="100">100</option>
        </select>
      </div>
      <div class="meta" id="pageMeta">Pagina ‚Äì</div>
      <div style="display:flex;gap:8px;flex-wrap:wrap;">
        <button class="btn" id="btnRefresh">üîÑ Aggiorna</button>
      </div>
    </div>

    <table>
      <thead>
        <tr>
          <th style="width:120px;">Data</th>
          <th>Gioco</th>
          <th style="width:140px;">Nome</th>
          <th style="width:130px;">Telefono</th>
          <th>Note</th>
          <th style="width:140px;">Stato</th>
          <th style="width:240px;">Azioni</th>
        </tr>
      </thead>
      <tbody id="rowsBody"></tbody>
    </table>
  </div>
</div>

<!-- LOGIN MODAL -->
<div class="modal-backdrop" id="modalLogin">
  <div class="modal" role="dialog" aria-modal="true">
    <button class="closeX" type="button" onclick="closeModal('modalLogin')">‚úñ</button>
    <h2>Accedi (admin)</h2>
    <div class="row">
      <div class="field" style="flex:1 1 200px;">
        <label>Username</label>
        <input id="loginUser" autocomplete="username">
      </div>
      <div class="field" style="flex:1 1 200px;">
        <label>Password</label>
        <input id="loginPass" type="password" autocomplete="current-password">
      </div>
    </div>
    <div style="display:flex;justify-content:flex-end;gap:10px;margin-top:8px;flex-wrap:wrap;">
      <button class="btn" type="button" onclick="doLogin()">Accedi</button>
      <button class="btn red" type="button" onclick="closeModal('modalLogin')">Annulla</button>
    </div>
    <div class="msg" id="loginMsg"></div>
  </div>
</div>

<script>
  const API_URL = "https://script.google.com/macros/s/AKfycbyoQBfaYvxQBTS_EnK1-IOlPjLoFT0sWn1jcHPuDg5t0nUkwrvKPY-x8Qg8ii5BmtLDYg/exec";
  const LS_USER_TOKEN = "AB_USER_TOKEN";
  const LS_PROFILE    = "AB_PROFILE";
  const LS_PREVIEW    = "AB_PREVIEW";

  let token = "";
  let profile = null;

  let page = 1;
  let pageSize = 25;
  let totalPages = 1;

  function E(id){ return document.getElementById(id); }

  function showError(msg){ const b=E("errorBox"); b.style.display="block"; b.textContent=msg; }
  function clearError(){ const b=E("errorBox"); b.style.display="none"; b.textContent=""; }
  function showInfo(msg){ const b=E("infoBox"); b.style.display="block"; b.textContent=msg; }
  function clearInfo(){ const b=E("infoBox"); b.style.display="none"; b.textContent=""; }

  function openModal(id){ E(id).style.display="flex"; }
  function closeModal(id){
    E(id).style.display="none";
    const m=E("loginMsg"); if(m) m.textContent="";
  }

  function jsonp(url, timeoutMs=18000){
    return new Promise((resolve,reject)=>{
      const cb = "cb_" + Math.random().toString(36).slice(2);
      const sep = url.includes("?") ? "&" : "?";
      const full = url + sep + "callback=" + cb;

      const s = document.createElement("script");
      let done=false;

      const timer=setTimeout(()=>{
        if(done) return;
        done=true;
        cleanup();
        reject(new Error("JSONP timeout"));
      }, timeoutMs);

      window[cb] = (data)=>{
        if(done) return;
        done=true;
        clearTimeout(timer);
        cleanup();
        resolve(data);
      };

      function cleanup(){
        try{ delete window[cb]; }catch(e){ window[cb]=undefined; }
        if(s && s.parentNode) s.parentNode.removeChild(s);
      }

      s.src = full;
      s.onerror = ()=>{
        if(done) return;
        done=true;
        clearTimeout(timer);
        cleanup();
        reject(new Error("JSONP load error"));
      };
      document.head.appendChild(s);
    });
  }

  async function sha256hex_async(text){
    if(window.crypto && window.crypto.subtle){
      const enc = new TextEncoder();
      const buf = await crypto.subtle.digest("SHA-256", enc.encode(text));
      return [...new Uint8Array(buf)].map(b=>b.toString(16).padStart(2,"0")).join("");
    }
    return sha256hex_fallback(text);
  }
  function sha256hex_fallback(ascii){
    function rightRotate(v,a){ return (v>>>a)|(v<<(32-a)); }
    var m=Math.pow, M=m(2,32), l="length", i,j,res="";
    var words=[], bitLen=ascii[l]*8;
    var h=sha256hex_fallback.h=sha256hex_fallback.h||[];
    var k=sha256hex_fallback.k=sha256hex_fallback.k||[];
    var pc=k[l];
    var comp={};
    for(var cand=2; pc<64; cand++){
      if(!comp[cand]){
        for(i=0;i<313;i+=cand) comp[i]=cand;
        h[pc]=(m(cand,.5)*M)|0;
        k[pc++]=(m(cand,1/3)*M)|0;
      }
    }
    ascii+="\x80";
    while(ascii[l]%64-56) ascii+="\x00";
    for(i=0;i<ascii[l];i++){
      j=ascii.charCodeAt(i);
      words[i>>2]|=j<<((3-i)%4)*8;
    }
    words[words[l]]=((bitLen/M)|0);
    words[words[l]]=bitLen;
    for(j=0;j<words[l];){
      var w=words.slice(j,j+=16), old=h.slice(0);
      for(i=0;i<64;i++){
        var w15=w[i-15], w2=w[i-2];
        var a=h[0], e=h[4];
        var t1=h[7]
          + (rightRotate(e,6)^rightRotate(e,11)^rightRotate(e,25))
          + ((e&h[5])^((~e)&h[6]))
          + k[i]
          + (w[i]=(i<16)?w[i]:(w[i-16]
            + (rightRotate(w15,7)^rightRotate(w15,18)^(w15>>>3))
            + w[i-7]
            + (rightRotate(w2,17)^rightRotate(w2,19)^(w2>>>10))
          )|0);
        var t2=(rightRotate(a,2)^rightRotate(a,13)^rightRotate(a,22))
          + ((a&h[1])^(a&h[2])^(h[1]&h[2]));
        h=[(t1+t2)|0].concat(h); h[4]=(h[4]+t1)|0; h.pop();
      }
      for(i=0;i<8;i++) h[i]=(h[i]+old[i])|0;
    }
    for(i=0;i<8;i++){
      for(j=3;j+1;j--){
        var b=(h[i]>>(j*8))&255;
        res+=((b<16)?0:"")+b.toString(16);
      }
    }
    return res;
  }

  function loadProfile(){
    try{
      const raw = localStorage.getItem(LS_PROFILE);
      profile = raw ? JSON.parse(raw) : null;
    }catch(e){ profile=null; }
  }

  async function refreshAuth(){
    token = localStorage.getItem(LS_USER_TOKEN) || "";
    loadProfile();

    E("btnLogout").style.display = token ? "inline-flex" : "none";
    E("btnLogin").style.display  = token ? "none" : "inline-flex";

    if(!token){
      showInfo("Accedi come admin per gestire le richieste.");
      return false;
    }

    try{
      const r = await jsonp(API_URL + "?action=me&token=" + encodeURIComponent(token), 12000);
      if(r && r.ok && r.profile){
        profile = r.profile;
        localStorage.setItem(LS_PROFILE, JSON.stringify(profile));
        if(profile.Ruolo !== "admin"){
          showError("Questo account non √® admin.");
          return false;
        }
        return true;
      }
    }catch(e){
      showError("Token non valido o scaduto. Fai login.");
      return false;
    }
    return false;
  }

  async function doLogin(){
    E("loginMsg").textContent = "";
    const u = (E("loginUser").value||"").trim().toLowerCase();
    const p = (E("loginPass").value||"");
    if(!u || !p){ E("loginMsg").textContent = "Inserisci username e password."; return; }

    const passhash = await sha256hex_async(p);

    try{
      const r = await jsonp(API_URL + "?action=login&username=" + encodeURIComponent(u) + "&passhash=" + encodeURIComponent(passhash), 18000);
      if(!r || !r.ok){
        E("loginMsg").textContent = "Login fallito: " + (r?.error || "sconosciuto");
        return;
      }
      localStorage.setItem(LS_USER_TOKEN, r.token);
      localStorage.setItem(LS_PROFILE, JSON.stringify(r.profile || null));
      closeModal("modalLogin");
      clearError(); clearInfo();
      await initPage(true);
    }catch(e){
      E("loginMsg").textContent = "Errore rete: " + e.message;
    }
  }

  function doLogout(){
    localStorage.removeItem(LS_USER_TOKEN);
    localStorage.removeItem(LS_PROFILE);
    profile=null; token="";
    showInfo("Sei uscito.");
  }

  function fmtDate(iso){
    if(!iso) return "";
    const d = new Date(iso);
    if(!isFinite(d.getTime())) return iso;
    return d.toLocaleString("it-IT",{day:"2-digit",month:"2-digit",hour:"2-digit",minute:"2-digit"});
  }

  function pill(st){
    const s = String(st||"").toLowerCase().trim();
    if(s==="nuova" || s==="richiesta") return '<span class="pill new">‚è≥ Nuova</span>';
    if(s==="approvata" || s==="prenotata") return '<span class="pill appr">‚úÖ Approvata</span>';
    if(s==="rifiutata") return '<span class="pill rej">‚ùå Rifiutata</span>';
    if(s==="eliminata" || s==="cancellata") return '<span class="pill del">üóëÔ∏è Eliminata</span>';
    return '<span class="pill">'+escapeHtml(st)+'</span>';
  }

  function escapeHtml(s){
    return String(s||"").replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
      .replaceAll('"',"&quot;").replaceAll("'","&#039;");
  }

  async function loadConfig(){
    const r = await jsonp(API_URL + "?action=get_config", 15000);
    if(r && r.ok && r.config){
      const c = r.config;
      E("cfgRequireLogin").value = c.requireLoginForRequest ? "1":"0";
      E("cfgCountdown").value = c.countdownEnabled ? "1":"0";
      E("cfgRevealAt").value = c.revealAtIso || "";
    }
  }

  async function saveConfig(){
    clearError(); clearInfo();
    const req = E("cfgRequireLogin").value;
    const cd  = E("cfgCountdown").value;
    const ra  = (E("cfgRevealAt").value||"").trim();

    try{
      const r = await jsonp(
        API_URL + "?action=set_config"
          + "&token=" + encodeURIComponent(token)
          + "&requireLoginForRequest=" + encodeURIComponent(req)
          + "&countdownEnabled=" + encodeURIComponent(cd)
          + "&revealAtIso=" + encodeURIComponent(ra),
        18000
      );
      if(!r || !r.ok){
        showError("Errore salvataggio: " + (r?.error || "sconosciuto"));
        return;
      }
      showInfo("Config salvata ‚úÖ");
    }catch(e){
      showError("Errore rete: " + e.message);
    }
  }

  async function loadPageData(){
    clearError(); clearInfo();

    const ps = parseInt(E("pageSize").value,10) || 25;
    pageSize = ps;

    try{
      const r = await jsonp(
        API_URL + "?action=admin_list"
          + "&token=" + encodeURIComponent(token)
          + "&page=" + encodeURIComponent(page)
          + "&pageSize=" + encodeURIComponent(pageSize),
        20000
      );

      if(!r || !r.ok){
        showError("Errore caricamento: " + (r?.error || "sconosciuto"));
        return;
      }

      totalPages = r.totalPages || 1;
      page = r.page || 1;

      E("pageMeta").textContent = `Pagina ${page}/${totalPages} ‚Ä¢ Totale richieste: ${r.total || 0}`;

      renderRows(r.rows || []);

      E("btnPrev").disabled = (page <= 1);
      E("btnNext").disabled = (page >= totalPages);

    }catch(e){
      showError("Errore: " + e.message);
    }
  }

  function renderRows(rows){
    const tb = E("rowsBody");
    tb.innerHTML = "";

    for(const it of rows){
      const tr = document.createElement("tr");

      const titolo = escapeHtml(it.Titolo||"");
      const gioc = escapeHtml(it.Giocatori||"");
      const nome = escapeHtml(it.Nome||"");
      const tel  = escapeHtml(it.Telefono||"");
      const note = escapeHtml(it.Note||"");
      const stato = it.Stato || "";

      tr.innerHTML = `
        <td><strong>${fmtDate(it.DataISO)}</strong><br><small>${escapeHtml(it.ID||"")}</small></td>
        <td><strong>${titolo}</strong><br><small>Giocatori: ${gioc}</small></td>
        <td>${nome}</td>
        <td>${tel}</td>
        <td>${note}</td>
        <td>${pill(stato)}<br><small>${escapeHtml(it.GestitoDa||"")} ${it.GestitoIl?("‚Ä¢ "+fmtDate(it.GestitoIl)):""}</small></td>
        <td>
          <div class="actions">
            <button class="btn" data-act="approve" data-id="${escapeHtml(it.ID||"")}">‚úÖ Approva</button>
            <button class="btn red" data-act="reject" data-id="${escapeHtml(it.ID||"")}">‚ùå Rifiuta</button>
            <button class="btn red" data-act="delete" data-id="${escapeHtml(it.ID||"")}">üóëÔ∏è Elimina</button>
          </div>
        </td>
      `;
      tb.appendChild(tr);
    }

    // bind azioni
    tb.querySelectorAll("button[data-act]").forEach(btn=>{
      btn.addEventListener("click", async ()=>{
        const act = btn.getAttribute("data-act");
        const id = btn.getAttribute("data-id");
        await doAdminAction(act, id);
      });
    });
  }

  async function doAdminAction(act, id){
    clearError(); clearInfo();
    if(!id) return;

    let action = "";
    if(act==="approve") action = "admin_approve";
    if(act==="reject")  action = "admin_reject";
    if(act==="delete")  action = "admin_delete";
    if(!action) return;

    try{
      const r = await jsonp(
        API_URL + "?action=" + action
          + "&token=" + encodeURIComponent(token)
          + "&id=" + encodeURIComponent(id),
        18000
      );
      if(!r || !r.ok){
        showError("Errore azione: " + (r?.error || "sconosciuto"));
        return;
      }
      showInfo("Operazione completata ‚úÖ");
      await loadPageData();
    }catch(e){
      showError("Errore rete: " + e.message);
    }
  }

  async function initPage(first){
    const ok = await refreshAuth();
    if(!ok){
      // se non loggato => apri login
      openModal("modalLogin");
      return;
    }

    // ok admin
    await loadConfig();
    await loadPageData();
    showInfo("Benvenuto admin ‚úÖ");
  }

  document.addEventListener("DOMContentLoaded", async ()=>{
    E("btnBack").addEventListener("click", ()=>{ window.location.href = "index.html"; });
    E("btnPreview").addEventListener("click", ()=>{
      // preview device (solo se admin)
      localStorage.setItem(LS_PREVIEW, "1");
      window.location.href = "index.html?preview=1";
    });

    E("btnLogin").addEventListener("click", ()=>openModal("modalLogin"));
    E("btnLogout").addEventListener("click", ()=>{ doLogout(); openModal("modalLogin"); });

    E("btnSaveCfg").addEventListener("click", saveConfig);

    E("btnRefresh").addEventListener("click", loadPageData);
    E("pageSize").addEventListener("change", ()=>{ page=1; loadPageData(); });
    E("btnPrev").addEventListener("click", ()=>{ if(page>1){ page--; loadPageData(); } });
    E("btnNext").addEventListener("click", ()=>{ if(page<totalPages){ page++; loadPageData(); } });

    await initPage(true);
  });
</script>

</body>
</html>
